#!/usr/bin/env node

const fs = require( 'fs/promises' );
const path = require( 'path' );
const flowbite = require( '@iconify/json/json/flowbite.json' );

async function main() {
	const icons = Object.entries( flowbite.icons )
		.filter( ( [ name ] ) => name.includes( '-outline' ) )
		.filter( ( [ , data ] ) => ! data.body.match( /<g[^>]*\bclip-path=/ ) )
		.map( ( [ name, data ] ) => ( {
			name,
			body: data.body.replace( ' stroke-width="2"', '' ),
		} ) );

	const escapeBody = ( body ) =>
		body.replace( /`/g, '\\`' ).replace( /\${/g, '\\${' );

	const entries = icons
		.map( ( { name, body } ) => {
			const lines = [
				'\t{',
				`\t\tname: "${ name }",`,
				`\t\tsvg: ( { strokeWidth = 2 } = {} ) => \`<svg`,
				'\t\t\txmlns="http://www.w3.org/2000/svg"',
				'\t\t\twidth="24"',
				'\t\t\theight="24"',
				'\t\t\tviewBox="0 0 24 24"',
				`\t\t\tstroke-width="\${ strokeWidth }"`,
				`\t\t>${ escapeBody( body ) }</svg>\`,`,
				'\t},',
			];
			return lines.join( '\n' );
		} )
		.join( '\n' );

const output = `// Auto-generated by bin/generate-flowbite-icons.js
export default [
${ entries }
];
`;

	const outputPath = path.join(
		process.cwd(),
		'src/formats/icon/flowbite-icons.js'
	);
	await fs.writeFile( outputPath, output );
}

main().catch( ( error ) => {
	console.error( error );
	process.exitCode = 1;
} );
