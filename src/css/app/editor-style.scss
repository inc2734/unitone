/**
 * Using add_editor_style() causes specificity issues.
 * The order of loading CSS for the core editor changes depending on the WP_DEBUG status.
 * Therefore, load CSS with enqueue_block_editor_assets instead of add_editor_styles().
 * However, the CSS output by @use settings includes :root, html and body,
 * which should be replaced by .editor-styles-wrapper in PHP.
 */

@use '../../../node_modules/@inc2734/unitone-css/src/settings/settings';

@use 'foundation';
@use 'blocks';
@use 'wp-blocks/wp-blocks';
@use 'main';
@use 'block-styles/block-styles';

.editor-styles-wrapper {
	@include foundation.include();
	@include wp-blocks.include();
	@include blocks.include();
	@include main.include();
	@include block-styles.include();

	.is-root-container.is-outline-mode.is-focus-mode {
		> [data-unitone-layout~="position"] {
			position: static;
		}
	}

	.edit-post-visual-editor__post-title-wrapper {
		margin-top: 0 !important;
		margin-bottom: var(--unitone--global--gap);
		border-bottom: 1px solid #e0e0e0;
		padding: var(--unitone--global--text-gap) var(--unitone--global--gutters);

		> * {
			max-width: var(--wp--custom--container-max-width) !important;
		}
	}

	:where([data-unitone-layout~="stack"] > *) {
		margin-right: 0;
		margin-left: 0;
	}

	[data-type="core/image"] .components-resizable-box__container {
		max-height: none !important;
		height: auto !important;
		max-width: 100% !important;
		display: block !important;
	}

	[data-unitone-layout~="layers"][data-unitone-layout~="-cover"],
	[data-unitone-layout~="layers"][data-unitone-layout~="-fill"] {
		> :first-child > [data-type="core/image"],
		> [data-type="core/image"]:first-child {
			.components-resizable-box__container {
				max-height: 100% !important;
				height: 100% !important;
			}
		}
	}

	[data-unitone-layout~="stack"],
	[data-unitone-layout~="center"] {
		> .block-list-appender:first-child {
			width: 100%;
		}
	}

	.wp-block-video:not(.is-selected),
	.wp-block-image:not(.is-selected) {
		.components-placeholder {
			display: flex;

			.components-placeholder__illustration {
				position: absolute;
				height: 100%;
				width: 100%;
			}
		}
	}

	[data-unitone-layout~="frame"] {
		.components-placeholder {
			min-height: auto !important;
		}

		svg {
			aspect-ratio: var(--unitone--ratio);
			position: static;
			transform: none;
		}
	}

	[data-unitone-layout~="frame"],
	[data-unitone-layout~="layers__layer"] {
		> figure {
			display: block;

			> .components-resizable-box__container,  /////
			> .components-disabled {
				> div {
					display: none; // Remove resizer
				}
			}

			> figcaption {
				display: none;
			}
		}
	}

	[data-unitone-layout~="frame"],
	[data-unitone-layout~="layers__layer"],
	[data-unitone-layout~="layers"][data-unitone-layout~="-cover"] > :first-child,
	[data-unitone-layout~="layers"][data-unitone-layout~="-fill"] > :first-child {
		.components-resizable-box__handle {
			display: none;
		}
	}

	[data-unitone-layout~="text"] {
		&[class*="wp-container-"] > * { // @todo For WordPress 6.0
			max-width: min(100%, var(--unitone--max-width));
		}

		&[data-unitone-layout~="-column"][class*="wp-container-"] > *, // @todo For WordPress 6.0
		&[data-unitone-layout~="-column"].is-layout-constrained > * {
			max-width: initial;
		}
	}

	[data-unitone-layout~="layers"] {
		&[data-unitone-layout~="-cover"],
		&[data-unitone-layout~="-fill"] {
			> :where(picture, figure) > div,
			>:first-child :where(picture, figure) > div {
				display: contents;
			}
		}

		> .block-list-appender {
			grid-row: auto;
		}
	}

	[data-type="unitone/cover"] {
		> .block-editor-block-variation-picker.has-many-variations {
			> .components-placeholder__fieldset {
				max-width: 100%;
			}
		}
	}

	[data-type="unitone/cluster-divided"],
	[data-type="unitone/stack-divided"],
	[data-type="unitone/responsive-grid-divided"] {
		> .block-list-appender {
			position: absolute;
			border: none;
			padding: 0;
			margin: 0;

			&::before {
				display: none;
			}
		}
	}

	[data-type="unitone/both-sides"] {
		> .block-list-appender {
			position: static;
		}
	}
}
